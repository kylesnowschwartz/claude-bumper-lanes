%% Onboarding Flow: Plugin install â†’ working status line
%% Render: cat onboarding-sequence.mmd | mermaid-ascii -f -
%% Focus: User-facing steps only (internal details omitted)

sequenceDiagram
    participant User
    participant CLI as Claude CLI
    participant CC as Claude Code
    participant FS as ~/.claude/

    %% Phase 1: Plugin Installation (two commands)
    User->>CLI: marketplace add kylesnowschwartz/claude-bumper-lanes
    CLI-->>User: plugin added

    User->>CLI: plugin install claude-bumper-lanes
    CLI-->>User: plugin installed

    %% Phase 2: First Session (auto-setup)
    User->>CC: start session in git repo
    CC->>CC: version check (plugin.json vs .build-version)
    CC->>CC: (builds Go binaries ~15s if new/updated)

    %% Auto-setup status line
    alt No existing status line
        CC->>FS: set statusLine.command to addon script (via jq)
        CC-->>User: stderr: Status line configured! Restart session.
    else Existing status line
        CC->>FS: generate wrapper at ~/.claude/bumper-lanes-statusline-wrapper.sh
        CC->>FS: update statusLine.command to wrapper (via jq)
        CC-->>User: stderr: Wrapped your status line. Restart session.
    end

    %% Phase 3: Working
    User->>CC: restart session
    CC-->>User: diff tree visible in status line

%% ============================================================
%% VALIDATION REFERENCES
%% ============================================================
%% - Plugin install: README.md:24-27
%% - Version sentinel: scripts/ensure-binaries.sh
%% - Auto-setup: internal/hooks/session_start.go:setupStatusLineWrapper()
%% - Wrapper generation: internal/hooks/session_start.go:generateWrapper()
%% - Settings update: internal/hooks/session_start.go:updateSettingsWithJq()
%%
%% RESOLVED PAIN POINTS (v2.1.0)
%% 1. Two CLI commands required - UNCHANGED (Claude Code limitation)
%% 2. 10-15s compile delay - UNCHANGED (Go build required)
%% 3. One-time stderr prompt easy to miss - NOW: auto-setup, no action needed
%% 4. Manual JSON editing required - NOW: auto via jq
%% 5. Session restart required - UNCHANGED (Claude Code limitation)
%%
%% OPT-OUT: Set "auto_statusline": false in .git/bumper-config.json
