%% Configuration Flow: All ways users configure bumper-lanes
%% Render: cat configuration-sequence.mmd | mermaid-ascii -f -
%% Focus: User-facing commands and their effects on storage

sequenceDiagram
    participant User
    participant CC as Claude Code
    participant Sess as Session State
    participant Config as .bumper-lanes.json

    %% === THRESHOLD CONFIGURATION ===

    %% Show current config
    User->>CC: /bumper-config
    CC->>Config: read threshold
    Config-->>CC: (may not exist)
    CC-->>User: Threshold: 400, Source: default

    %% Set threshold (applies immediately)
    User->>CC: /bumper-config 300
    CC->>Config: write threshold: 300
    CC->>Sess: update threshold_limit: 300
    CC-->>User: Threshold set to 300.

    %% === VIEW MODE CONFIGURATION ===

    %% Per-mode command (immediate, no opts)
    User->>CC: /bumper-tree
    CC->>Sess: set view_mode: tree
    CC->>Config: persist default_view_mode: tree
    CC-->>User: View: tree

    %% View command with opts (both persisted now)
    User->>CC: /bumper-view icicle --width 80
    CC->>Sess: set view_mode: icicle, view_opts: --width 80
    CC->>Config: persist view_mode + view_opts
    CC-->>User: View mode set to: icicle --width 80

    %% Show current view mode
    User->>CC: /bumper-view
    CC->>Sess: get view_mode
    Sess-->>CC: icicle
    CC-->>User: Current: icicle. Available: tree, collapsed...

%% ============================================================
%% VALIDATION REFERENCES
%% ============================================================
%% - Config load: internal/config/config.go:66-110
%% - Threshold set: internal/hooks/prompt_handler.go:209-253
%% - View mode set: internal/hooks/prompt_handler.go:152-207
%% - View opts storage: internal/state/session.go:27-28
%% - Persist view: internal/hooks/view.go:63-72
%%
%% CONFIGURATION SURFACE AREA
%% - Threshold: 50-2000 points (default 400)
%% - View modes: tree, collapsed, smart, topn, icicle, brackets
%% - View opts: --width N, --depth N (now persisted!)
%%
%% Config file: .bumper-lanes.json at repo root
%% Users can add to .gitignore if they don't want to track
