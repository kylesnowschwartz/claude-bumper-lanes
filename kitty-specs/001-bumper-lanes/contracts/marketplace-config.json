{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Marketplace Configuration Contract",
  "description": "Contract for .claude-plugin/marketplace.json - defines plugin catalog for local development and distribution",

  "file_location": ".claude-plugin/marketplace.json",

  "schema": {
    "type": "object",
    "properties": {
      "name": {
        "type": "string",
        "pattern": "^[a-z0-9]+(-[a-z0-9]+)*$",
        "description": "Marketplace identifier (kebab-case, required)",
        "example": "local-dev"
      },
      "owner": {
        "type": "object",
        "description": "Marketplace maintainer information",
        "properties": {
          "name": {
            "type": "string",
            "description": "Maintainer name"
          },
          "email": {
            "type": "string",
            "format": "email",
            "description": "Maintainer email"
          }
        },
        "required": ["name", "email"]
      },
      "description": {
        "type": "string",
        "description": "Human-readable marketplace description"
      },
      "version": {
        "type": "string",
        "pattern": "^\\d+\\.\\d+\\.\\d+$",
        "description": "Marketplace catalog version"
      },
      "pluginRoot": {
        "type": "string",
        "description": "Relative path prefix for plugin sources (optional)"
      },
      "plugins": {
        "type": "array",
        "description": "Array of available plugins in this marketplace",
        "items": {
          "type": "object",
          "properties": {
            "name": {
              "type": "string",
              "pattern": "^[a-z0-9]+(-[a-z0-9]+)*$",
              "description": "Plugin identifier (kebab-case)"
            },
            "version": {
              "type": "string",
              "pattern": "^\\d+\\.\\d+\\.\\d+$",
              "description": "Plugin version (semantic versioning)"
            },
            "source": {
              "oneOf": [
                {
                  "type": "string",
                  "description": "Relative file path to plugin directory",
                  "pattern": "^\\./",
                  "example": "./plugins/claude-bumper-lanes"
                },
                {
                  "type": "object",
                  "description": "GitHub repository reference",
                  "properties": {
                    "source": {
                      "type": "string",
                      "const": "github"
                    },
                    "repo": {
                      "type": "string",
                      "pattern": "^[^/]+/[^/]+$",
                      "description": "GitHub repository in owner/repo format"
                    }
                  },
                  "required": ["source", "repo"]
                }
              ]
            },
            "description": {
              "type": "string",
              "description": "Plugin description shown in /plugin browse"
            }
          },
          "required": ["name", "version", "source"]
        }
      }
    },
    "required": ["name", "owner", "plugins"]
  },

  "example_local_dev_marketplace": {
    "name": "local-dev",
    "owner": {
      "name": "Plugin Developer",
      "email": "dev@example.com"
    },
    "description": "Local marketplace for plugin development",
    "version": "1.0.0",
    "plugins": [
      {
        "name": "claude-bumper-lanes",
        "version": "1.0.0",
        "source": "./",
        "description": "Git diff threshold enforcement for disciplined vibe coding"
      }
    ]
  },

  "example_github_marketplace": {
    "name": "kylesnowschwartz-plugins",
    "owner": {
      "name": "Kyle Snow Schwartz",
      "email": "kyle@kylesnowschwartz.com"
    },
    "description": "Kyle's Claude Code plugin marketplace",
    "version": "1.0.0",
    "pluginRoot": "./plugins",
    "plugins": [
      {
        "name": "claude-bumper-lanes",
        "version": "1.0.0",
        "source": {
          "source": "github",
          "repo": "kylesnowschwartz/claude-bumper-lanes"
        },
        "description": "Git diff threshold enforcement"
      },
      {
        "name": "other-plugin",
        "version": "2.1.0",
        "source": "./other-plugin",
        "description": "Another useful plugin"
      }
    ]
  },

  "usage": {
    "local_development": [
      "1. Create .claude-plugin/marketplace.json in plugin repository root",
      "2. Add marketplace: /plugin marketplace add . (from plugin directory)",
      "3. Install plugin: /plugin install plugin-name@local-dev",
      "4. Validate: claude plugin validate .",
      "5. Test plugin functionality in Claude Code session"
    ],
    "team_distribution": [
      "1. Create marketplace repository with multiple plugin entries",
      "2. Team adds marketplace: /plugin marketplace add org-name/marketplace-repo",
      "3. Or configure in .claude/settings.json for auto-installation",
      "4. Users install: /plugin install plugin-name@marketplace-name"
    ]
  },

  "commands": {
    "add_marketplace": "/plugin marketplace add <github-org/repo> or /plugin marketplace add <./local-path>",
    "list_marketplaces": "/plugin marketplace list",
    "browse_plugins": "/plugin browse",
    "install_plugin": "/plugin install <plugin-name@marketplace-name>",
    "list_installed": "/plugin list",
    "enable_plugin": "/plugin enable <plugin-name@marketplace-name>",
    "disable_plugin": "/plugin disable <plugin-name@marketplace-name>",
    "uninstall_plugin": "/plugin uninstall <plugin-name@marketplace-name>",
    "validate_structure": "claude plugin validate . (CLI command, not slash command)"
  },

  "notes": [
    "For local development, source path ./ refers to the directory containing marketplace.json",
    "GitHub sources automatically clone and update on install",
    "Users can mix local and GitHub sources in same marketplace",
    "Marketplace name must be unique across all added marketplaces",
    "Plugin names must be unique within a marketplace",
    "Version strings must follow semantic versioning (MAJOR.MINOR.PATCH)",
    "The /plugin commands are executed within Claude Code sessions",
    "The claude plugin validate command is a CLI command run in terminal"
  ]
}
